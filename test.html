<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduled Appointments Finder</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

    <h3>Find Scheduled Appointments</h3>
    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate">
    <label for="endDate">End Date:</label>
    <input type="date" id="endDate">
    <button onclick="fetchAppointments()">Fetch Appointments</button>

    <table id="appointmentsTable" border="1">
        <thead>
            <tr>
                <th>Appointment ID</th>
                <th>Date</th>
                <th>Start Time</th>
                <th>Sales Rep</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const API_URL = 'https://brighthousesolar.fieldroutes.com/api';
const API_KEY = '2l6dhlhl6tltpfu98dpvb6770a0mrro8i1tcctk66ksurks44ceohif28o30um17';
const API_TOKEN = '8ebgdsgiihnutdglcponabcvadj5166nmob6m8g2gnene3v0eqvb8q2385ouedcu';
let salesRepNames = {};

async function fetchEmployeeName(employeeID) {
    const response = await fetch(`${API_URL}/employee/${employeeID}`);
    const data = await response.json();
    console.log("Employee data for ID " + employeeID, data);  // Logging the response
    return `${data.fname} ${data.lname}`;
}


async function fetchSalesRepNamesForAppointments(appointments) {
    for (let appointment of appointments) {
        appointment.salesRepName = await fetchEmployeeName(appointment.employeeID);
    }
}


async function fetchAppointments() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    // Adjust parameters based on the new endpoint requirements
    const params = {
        dateStart: startDate,
        dateEnd: endDate,
        includeData: 1
    };

    try {
        const response = await fetch(API_URL + '/appointment/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                ...params,
                authenticationKey: API_KEY,
                authenticationToken: API_TOKEN
            })
        });
        const responseJSON = await response.json();
        if (responseJSON.success && Array.isArray(responseJSON.appointments)) {
            await fetchSalesRepNamesForAppointments(responseJSON.appointments);
            displayData(responseJSON.appointments);
        } else {
            console.error('Unexpected data format:', responseJSON);
        }
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

function displayData(data) {
    const tableBody = document.getElementById('appointmentsTable').querySelector('tbody');
    tableBody.innerHTML = '';

    data.forEach(appointment => {
        const row = tableBody.insertRow();
        row.insertCell().textContent = appointment.appointmentID;
        row.insertCell().textContent = appointment.date;
        row.insertCell().textContent = appointment.start || 'N/A';
        row.insertCell().textContent = appointment.salesRepName || 'N/A';
        row.insertCell().textContent = appointment.statusText || 'N/A';
    });
}
    </script>
</body>
</html>
